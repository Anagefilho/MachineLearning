This was a homework, I didn't finish it but it works in some parts.
